<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TrámiteYA – MVP</title>
  <style>
    :root {
      --bg: #F7F7F7;
      --surface: #FFFFFF;
      --ink: #0F172A;
      --muted: #64748B;
      --primary: #0EA5E9;
      --success: #16A34A;
      --danger: #DC2626;
      --radius: 14px;
      --shadow: 0 1px 2px rgba(0,0,0,.08);
      --tap: 44px;
      --gap: 12px;
    }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      font-size: 16px;
      line-height: 1.4;
      background: var(--bg);
      color: var(--ink);
      margin: 0;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--ink);
      color: #fff;
      padding: 12px 16px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header .brand {
      font-weight: 800;
      font-size: 18px;
      letter-spacing: 0.5px;
    }
    header .actions {
      display: flex;
      gap: 8px;
    }
    main {
      max-width: 720px;
      margin: 0 auto;
      padding: 12px 16px 24px;
    }
    .card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      margin-bottom: 12px;
    }
    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--gap);
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
      gap: var(--gap);
    }
    .page-title { font-size:24px; font-weight:800; margin:0 0 12px; }
    .title {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 6px;
    }
    .big { font-size:16px; font-weight:700; color:#0f172a; }
    .muted {
      color: var(--muted);
      font-size: 13px;
    }
    .btn {
      background: var(--primary);
      color: #fff;
      border: 0;
      border-radius: 10px;
      padding: 10px 14px;
      min-height: var(--tap);
      font-weight: 600;
      cursor: pointer;
      transition: background .2s;
      font-size: 15px;
      box-sizing: border-box;
      outline: none;
    }
    .btn:hover {
      background: #0284c7;
    }
    .btn.secondary {
      background: #E2E8F0;
      color: var(--ink);
    }
    .btn.ghost {
      background: transparent;
      color: var(--primary);
      border: 1px solid var(--primary);
    }
    .btn:disabled {
      opacity: .6;
      cursor: not-allowed;
    }
    input, select {
      width: 100%;
      min-height: var(--tap);
      border: 1px solid #CBD5E1;
      border-radius: 10px;
      padding: 10px;
      font-size: 15px;
      margin-bottom: 8px;
      box-sizing: border-box;
    }
    label {
      display: block;
      margin: 8px 0 6px;
      font-size: 14px;
      color: #334155;
    }
    .pill { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; font-size:13px; }
    .pill.success { background:#E6F9ED; color:#16A34A; }
    .pill.warn { background:#FEF3C7; color:#92400E; }
    .pill.error { background:#FEE2E2; color:#DC2626; }
    .hr {
      height: 1px;
      background: #e2e8f0;
      margin: 12px 0 16px;
    }
    .hidden {
      display: none !important;
    }
    .price {
      font-weight: 700;
      font-size: 16px;
      color: var(--primary);
    }
    .history-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .h-item {
      border: 1px solid #E2E8F0;
      border-radius: 10px;
      padding: 10px;
      background: var(--surface);
      margin-bottom: 4px;
    }
    .h-head, .h-foot {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }
    .h-foot {
      margin-top: 6px;
    }
    #status-json pre {
      background: #FAFAFA;
      border: 1px solid #EEE;
      border-radius: 8px;
      font-size: 13px;
      padding: 8px;
      overflow: auto;
      margin: 8px 0 0;
    }
    #pay-sim { display: block !important; }
    #pay-sim.hidden { display: none !important; }
    .paybox { max-height: none !important; opacity: 1 !important; }
    @media (max-width: 600px) {
      main { padding: 8px 4px 16px; }
      .card { padding: 12px; }
      .btn { padding: 10px 8px; font-size: 14px; }
      .title { font-size: 16px; }
      header { padding: 10px 8px; }
    }


    .icon-copy {
  width: 16px;
  height: 16px;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.2s;
}
.icon-copy:hover {
  opacity: 1;
}
.icon-copy:active {
  transform: scale(0.9);
}


.section-hint { color: var(--muted); font-size: 13px; margin: 4px 0 10px; }

    .money .money-row { display:flex; justify-content:space-between; align-items:center; padding:8px 0; }
    .money .money-row.total strong { font-size:18px; }

    /* ===== Banner MVP ===== */
    .banner {
      position: sticky;
      top: 0; z-index: 20;
      width: 100%;
      box-sizing: border-box;
      padding: 10px 14px;
      font-size: 14px;
      line-height: 1.3;
      background: #E2E8F0;   /* info por defecto */
      color: #0F172A;
      border-bottom: 1px solid #CBD5E1;
    }
    .banner.is-error { background: #FEE2E2; color: #7F1D1D; border-bottom-color: #FCA5A5; }
    .banner.is-warn  { background: #FEF3C7; color: #92400E; border-bottom-color: #FCD34D; }
    .banner.is-info  { background: #DBEAFE; color: #1E3A8A; border-bottom-color: #93C5FD; }
    .banner.hidden   { display: none; }

    /* --- Desglose (premium) --- */
    .card.money{padding:12px 16px;background:#fff;border:1px solid #e2e8f0;border-radius:12px}
    .money-row{display:flex;align-items:center;justify-content:space-between;padding:4px 0 2px 0;font-size:14px;margin:0;}
    .money-row span{color:#475569;text-align:left;}
    .money-row strong{text-align:right;min-width:80px;display:inline-block;font-weight:700;}
    .money-row.total{border-top:1px solid #e2e8f0;margin-top:8px;padding-top:10px;}
    .money-row.total strong{font-size:17px;font-weight:800;}

    /* CTA full width */
    .btn.block{width:100%}

    /* Form section blocks */
    .section-block{margin-bottom:0;padding:0 0 0 0;}
    .form-section-title{display:flex;align-items:center;font-size:16px;font-weight:700;margin:0 0 4px 0;color:#0f172a;padding-left:2px;}
    .form-section-title .section-ico{font-size:16px;margin-right:6px;}
    .form-section-help{font-size:12px;color:#64748b;margin:0 0 8px 2px;padding-left:22px;}
    .section-content{padding-left:22px;}
    .hr{border-top:1px solid #eee;}
  </style>
  <style>
    body.on-form #btn-reload,
    body.on-form #btn-history {
      display: none;
    }
    body.on-form #btn-reload { display: none; }
    #btn-history { display: inline-flex !important; }
  </style>


<style>
  .fab-whatsapp{
  position: fixed;
  right: 20px;
  bottom: 20px;
  width: 56px; height: 56px;
  border-radius: 50%;
  background: #25D366;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 8px rgba(0,0,0,.25);
  z-index: 9999;
  text-decoration: none;
}
.fab-whatsapp img{
  width: 28px; height: 28px; display: block;
}

/* Evita que reglas globales estiren el ícono */
.fab-whatsapp * { max-width: none !important; max-height: none !important; }

/* Respeta el notch / safe-area en iOS */
@supports(padding:max(0px)){
  .fab-whatsapp{ right: max(20px, env(safe-area-inset-right)); bottom: max(20px, env(safe-area-inset-bottom)); }
}

/* Pequeño hover (desktop) */
@media (hover:hover){
  .fab-whatsapp:hover{ transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,.28); }
}

</style>

<style>
.confetti { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 9999; }
.confetti__piece { position: absolute; width: 8px; height: 14px; border-radius: 2px; opacity: .9; animation: fallConfetti 700ms ease-out forwards; }
@keyframes fallConfetti { from { transform: translateY(-20vh) rotate(0deg); } to { transform: translateY(100vh) rotate(280deg); } }
@media (prefers-reduced-motion: reduce) { .confetti, .confetti__piece { display: none !important; } }
</style>

<style>
.confetti{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:9999}
.confetti__piece{position:absolute;width:8px;height:14px;border-radius:2px;opacity:.9;animation:fallConfetti 700ms ease-out forwards}
@keyframes fallConfetti{from{transform:translateY(-20vh) rotate(0deg)}to{transform:translateY(100vh) rotate(280deg)}}
@media (prefers-reduced-motion: reduce){.confetti,.confetti__piece{display:none!important}}

/* ==== STATUS HERO (no romper estilos actuales) ==== */
.status-hero{
  display:flex; align-items:flex-start; gap:12px;
  background:#E6F9ED; color:#14532d; /* success por defecto */
  border:1px solid rgba(0,0,0,.06);
  border-radius: var(--radius);
  padding:14px 16px;
  box-shadow: var(--shadow);
  margin-bottom: 12px;
}
.status-hero__icon{ font-size:22px; line-height:1; margin-top:2px; }
.status-hero__content{ flex:1 1 auto; }
.status-hero__title{ margin:0 0 4px; font-size:18px; font-weight:800; }
.status-hero__subtitle{ margin:0; font-size:14px; opacity:.9; }
.status-hero__time{ white-space:nowrap; font-size:13px; color:#334155; opacity:.8; }

/* Modificadores de estado (colores suaves, sin afectar otros componentes) */
.status-hero.is-success{ background:#E6F9ED; color:#166534; }
.status-hero.is-pending{ background:#FEF3C7; color:#92400E; }
.status-hero.is-error  { background:#FEE2E2; color:#991B1B; }
</style>

</head>
<body>
<header>
  <div class="brand">TrámiteYA (Emulador)</div>
  <div class="actions">
    <button id="btn-reload" class="btn secondary">Recargar catálogo</button>
    <button id="btn-history" class="btn secondary">Mis solicitudes</button>
  </div>
</header>

<!-- Banner de mensajes (MVP) -->
<div id="banner" class="banner hidden" role="status" aria-live="polite">
  <span id="banner-text">—</span>
</div>

<main>

  <!-- LISTA -->
  <section id="screen-list" class="card">
    <h1 class="page-title">Catálogo de trámites</h1>
    <div class="hr"></div>
    <div id="services" class="grid"></div>
    <div id="empty" class="muted hidden">No hay trámites disponibles.</div>
    <div class="hr"></div>
    <div id="history" class="">
      <h1 class="page-title">Mis solicitudes (en este dispositivo)</h1>
      <div class="hr"></div>
      <div class="row">
        <div class="muted">Solo visibles en este teléfono</div>
        <div class="spacer"></div>
        <button id="btn-clear-history" class="btn ghost">Limpiar historial</button>
      </div>
      <div id="history-list" class="history-list muted"></div>
    </div>
  </section>

  <!-- FORM -->
 
  <section id="screen-form" class="card hidden">
    <button id="btn-back" class="btn secondary">← Volver</button>
    <div class="hr"></div>

    <div id="svc-head" class="row">
      <div class="title">Trámite</div>
    </div>

    <!-- El FORM ahora contiene: Contacto + Desglose + Campos del trámite -->
    <form id="form">
      <!-- 1) CONTACTO -->
      <div class="hr" style="border-top:1px solid #eee"></div>
      <!-- Contacto solo una vez, con id único -->
      <div class="section-block" id="contact-block">
        <div class="form-section-title"><span class="section-ico">👤</span>Contacto</div>
        <div class="section-content">
          <p class="form-section-help" style="margin:4px 0 8px">Usaremos estos datos para entregarte tu certificado.</p><p></p>
          <label for="contact_name">Nombre completo *</label>
          <input name="contact_name" id="contact_name" type="text" autocomplete="name" required>
          <label for="contact_email">Correo *</label>
          <input name="contact_email" id="contact_email" type="email" autocomplete="email" required>
          <label for="contact_phone">Celular *</label>
          <input name="contact_phone" id="contact_phone" type="tel" inputmode="tel" pattern="^[0-9 +()-]{7,}$" required>
        </div>
      </div>

      <!-- 2) DESGLOSE -->
      <div class="section-block">
        <div class="form-section-title"><span class="section-ico">💵</span>Desglose de precios</div>
        <div class="section-content">
          <p class="form-section-help" style="margin:4px 0 8px">Este es el valor a pagar.</p><p></p>
          <div class="card money" id="form-money">
            <div class="money-row"><span>Valor base</span><strong id="form-price-base">—</strong></div>
            <div class="money-row"><span>IVA</span><strong id="form-price-tax">—</strong></div>
            <div class="money-row"><span>Servicio</span><strong id="form-price-fee">—</strong></div>
            <div class="money-row total"><span>Total</span><strong id="form-price-total">—</strong></div>
          </div>
        </div>
      </div>
      <div class="hr" style="border-top:1px solid #eee"></div>
<p></p>
      <!-- 3) CAMPOS DEL TRÁMITE (se pintan dinámicamente en este contenedor) -->
      <div class="section-block">
        <div class="form-section-title"><span class="section-ico">📄</span>Datos para el trámite</div>
        <div class="section-content">
          <p class="form-section-help">Estos datos se usan para generar el documento.</p><p></p>
          <div id="dyn-fields"></div>
        </div>
      </div>
    </form>
<div class="hr" style="border-top:1px solid #eee"></div>
    <!-- Botón principal fuera del form (lo maneja JS) -->
    <div style="margin-top:12px">
      <button id="btn-create" class="btn block">Crear orden</button>
    </div>

    <!-- Simulador de pago -->
    <div id="pay-sim" class="hidden">
      <div class="hr"></div>
      <div class="paybox card">
        <details id="simulator">
          <summary style="font-weight:700; cursor:pointer;">🧪 Simulador de pago (sólo emulador)</summary>
          <div class="muted" style="margin:8px 0;">
            Estás saliendo de TrámiteYA, simulando Wompi. Selecciona un resultado:
          </div>
          <div class="row" style="gap:12px; flex-wrap:wrap;">
            <button class="btn" data-sim="success" style="background:#16a34a">✅ Pago exitoso</button>
            <button class="btn" data-sim="insufficient" style="background:#f59e0b">⚠️ Saldo insuficiente</button>
            <button class="btn" data-sim="canceled" style="background:#475569">❌ Cancelado por usuario</button>
            <button class="btn" data-sim="error" style="background:#dc2626">❌ Error técnico</button>
          </div>
        </details>
      </div>
    </div>
  </section>
  <!-- FIN FORM -->


  <!-- ESTADO -->
  <section id="screen-status" class="card hidden">
    <div class="title page-title">Estado de tu solicitud</div>
    <div class="hr"></div>

    <!-- HERO DE ESTADO (nuevo) -->
    <section id="status-hero" class="status-hero is-success">
      <div class="status-hero__icon" id="hero-ico" aria-hidden="true">✅</div>
      <div class="status-hero__content">
        <h2 class="status-hero__title" id="hero-title">¡Pago aprobado!</h2>
        <p class="status-hero__subtitle" id="hero-sub">
          Tu pago fue procesado con éxito. Te avisaremos por correo/WhatsApp cuando tu certificado esté listo.
        </p>
      </div>
      <div class="status-hero__time" id="hero-date">—</div>
    </section>

    <div class="card trust">
      <div class="row">
        <div id="badge-status" class="pill">—</div>
        <div class="spacer"></div>
        <div class="muted" id="order-date">—</div>
      </div>
      <div class="summary">
        <div class="row">
          <div>

<div class="muted">N° de orden</div>
<div style="display:flex;align-items:center;gap:6px;">
  <div class="big" id="order-id">—</div>
  <img 
    src="img/copiar.png" 
    alt="Copiar" 
    class="icon-copy" 
    title="Copiar" 
    data-copy="#order-id">
</div>
<div class="muted" style="margin-top:2px;">Contacto: <span id="order-contact">—</span></div>

          </div>
          <div>
            <div class="muted">Trámite</div>
            <div class="big" id="order-service">—</div>
          </div>
        </div>
        <div class="row">
          <div>
            <div class="muted">Pago</div>
            <div id="status-payment" class="big">—</div>
          </div>
          <div>
            <div class="muted">Entrega</div>
            <div id="status-delivery" class="big">—</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Trust badges row for premium status section -->
    <div class="trust-row">
      <div class="trust-badge" id="trust-sec">
        <span class="trust-ico">🔒</span>
        <span>Datos protegidos</span>
      </div>
      <div class="trust-badge" id="trust-pay">
        <span class="trust-ico">✅</span>
        <span>Pago seguro</span>
      </div>
      <div class="trust-badge" id="trust-sla">
        <span class="trust-ico">⏱️</span>
        <span id="trust-sla-text">Entrega aprox 24h</span>
      </div>
    </div>

    <div class="card money">
      <div class="title">Detalle de cobro</div>
      <div class="row money-row"><span>Valor base</span><strong id="price-base">—</strong></div>
      <div class="row money-row"><span>IVA</span><strong id="price-tax">—</strong></div>
      <div class="row money-row"><span>Servicio</span><strong id="price-fee">—</strong></div>
      <div class="hr"></div>
      <div class="row money-row total"><span>Total</span><strong id="price-total">—</strong></div>
    </div>

    <div class="card info">
      <div class="title">Sigue tu trámite</div>
      <p class="muted" id="friendly-message">—</p>
      <div class="row">
        <button id="btn-retry" class="btn secondary">Volver al catálogo</button>
      </div>
    </div>

    <div class="card debug">
      <div class="title">Detalles técnicos</div>
      <div id="status-json" class="muted"><pre style="background:#fafafa;border:1px solid #eee;padding:8px;border-radius:8px;overflow:auto;font-size:13px"></pre></div>
    </div>
  </section>

</main>

<script defer src="./main.js?v=17"></script>
<script>
// Helper para eliminar duplicados del bloque de contacto
function ensureSingleContactBlock() {
  const form = document.getElementById('form');
  if (!form) return;
  const blocks = form.querySelectorAll('#contact-block');
  blocks.forEach((b, i) => { if (i > 0) b.remove(); }); // deja solo el primero
}

// Observa el <form> y deduplica si alguien inyecta Contacto
document.addEventListener('DOMContentLoaded', () => {
  const formForObserver = document.getElementById('form');
  if (formForObserver) {
    ensureSingleContactBlock(); // primera pasada
    const obs = new MutationObserver(() => ensureSingleContactBlock());
    obs.observe(formForObserver, { childList: true, subtree: true });
  }
});
</script>

<!-- FAB WhatsApp -->
<a id="fab-whatsapp"
   class="fab-whatsapp"
   href="https://wa.me/573001234567?text=Hola%20necesito%20ayuda%20con%20Tr%C3%A1miteYA"
   target="_blank" rel="noopener"
   aria-label="Ayuda por WhatsApp">
  <img src="./img/whatsapp.png" alt="WhatsApp">
</a>

</body>
</html>

